/*
 * jquery.flot.tooltip
 * 
 * description: easy-to-use tooltips for Flot charts
 * version: 0.5
 * author: Krzysztof Urbas @krzysu [myviews.pl]
 * website: https://github.com/krzysu/flot.tooltip
 * 
 * build on 2012-12-30
 * released under MIT License, 2012
*/
(function(a){var b={defaultOptions:{tooltip:!1,tooltipOpts:{content:"%s | X: %x | Y: %y",xDateFormat:null,yDateFormat:null,shifts:{x:10,y:20},defaultTheme:!0,onHover:function(a,b){}}},tipPosition:{x:0,y:0},init:function(c){var d=b;c.hooks.bindEvents.push(function(b,c){d.plotOptions=b.getOptions();if(d.plotOptions.tooltip===!1||typeof d.plotOptions.tooltip=="undefined")return;d.tooltipOptions=d.plotOptions.tooltipOpts;var e=d.getDomElement();a(b.getPlaceholder()).bind("plothover",function(a,b,c){if(c){var f;f=d.stringFormat(d.tooltipOptions.content,c),e.html(f).css({left:d.tipPosition.x+d.tooltipOptions.shifts.x,top:d.tipPosition.y+d.tooltipOptions.shifts.y}).show(),typeof d.tooltipOptions.onHover=="function"&&d.tooltipOptions.onHover(c,e)}else e.hide().html("")}),c.mousemove(d.onMouseMove)})},getDomElement:function(){var b;return a("#flotTip").length>0?b=a("#flotTip"):(b=a("<div />").attr("id","flotTip"),b.appendTo("body").hide().css({position:"absolute"}),this.tooltipOptions.defaultTheme&&b.css({background:"#fff","z-index":"100",padding:"0.4em 0.6em","border-radius":"0.5em","font-size":"0.8em",border:"1px solid #111"})),b},onMouseMove:function(a){var c={x:0,y:0};c.x=a.pageX,c.y=a.pageY,b.updateTooltipPosition(c)},updateTooltipPosition:function(a){this.tipPosition.x=a.x,this.tipPosition.y=a.y},stringFormat:function(a,b){var c=/%p\.{0,1}(\d{0,})/,d=/%s/,e=/%x\.{0,1}(\d{0,})/,f=/%y\.{0,1}(\d{0,})/;return typeof b.series.percent!="undefined"&&(a=this.adjustValPrecision(c,a,b.series.percent)),typeof b.series.label!="undefined"&&(a=a.replace(d,b.series.label)),this.isTimeMode("xaxis",b)&&this.isXDateFormat(b)&&(a=a.replace(e,this.timestampToDate(b.series.data[b.dataIndex][0],this.tooltipOptions.xDateFormat))),this.isTimeMode("yaxis",b)&&this.isYDateFormat(b)&&(a=a.replace(f,this.timestampToDate(b.series.data[b.dataIndex][1],this.tooltipOptions.yDateFormat))),typeof b.series.data[b.dataIndex][0]=="number"&&(a=this.adjustValPrecision(e,a,b.series.data[b.dataIndex][0])),typeof b.series.data[b.dataIndex][1]=="number"&&(a=this.adjustValPrecision(f,a,b.series.data[b.dataIndex][1])),typeof b.series.xaxis.tickFormatter!="undefined"&&(a=a.replace(e,b.series.xaxis.tickFormatter(b.series.data[b.dataIndex][0],b.series.xaxis))),typeof b.series.yaxis.tickFormatter!="undefined"&&(a=a.replace(f,b.series.yaxis.tickFormatter(b.series.data[b.dataIndex][1],b.series.yaxis))),a},isTimeMode:function(a,b){return typeof b.series[a].options.mode!="undefined"&&b.series[a].options.mode==="time"},isXDateFormat:function(a){return typeof this.tooltipOptions.xDateFormat!="undefined"&&this.tooltipOptions.xDateFormat!==null},isYDateFormat:function(a){return typeof this.tooltipOptions.yDateFormat!="undefined"&&this.tooltipOptions.yDateFormat!==null},timestampToDate:function(b,c){var d=new Date(b);return a.plot.formatDate(d,c)},adjustValPrecision:function(a,b,c){var d;return b.match(a)!=="null"&&RegExp.$1!==""&&(d=RegExp.$1,c=c.toFixed(d),b=b.replace(a,c)),b}};a.plot.plugins.push({init:b.init,options:b.defaultOptions,name:"tooltip",version:"0.5"})})(jQuery);